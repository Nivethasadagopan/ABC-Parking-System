<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui" xml:lang="en" lang="en">

<h:head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Search Parking Space</title>

	<!-- Font Awesome for icons -->
	<script src="https://kit.fontawesome.com/a076d05399.js"
		crossorigin="anonymous"></script>

	<style>
	
body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: url("resources/images/Member Image.jpg") no-repeat center center fixed;
    background-size: cover;   /* make it cover full screen */
}


#container {
	background-color: rgba(0, 0, 0, 0.5);
	padding: 20px;
	border-radius: 8px;
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
	max-width: 1200px;
	margin: 0 auto;
	position: relative;
	z-index: 1;
}

/* Bright blue header */
header {
	background-color: rgba(0, 0, 0, 0.5);;
	color: white;
	padding: 15px;
	border-radius: 8px 8px 0 0;
	text-align: center;
	margin-bottom: 20px;
}

header .header-title {
	font-size: 1.25rem;
	display: flex;
	align-items: center;
	justify-content: center;
	gap: 0.5rem;
}

header .header-title i {
	color: white;
}

.search-box h2 {
	color: #fff;
	border-bottom: 2px solid #8bb611;
	padding-bottom: 10px;
	margin-bottom: 20px;
}

.search-section {
	background-color: #f8f9fa;
	padding: 20px;
	border-radius: 6px;
	margin: 20px 0;
	border-left: 4px solid #8bb611;
}

.search-section h3 {
	margin: 0 0 15px 0;
	color: #8bb611;
	font-size: 1.1rem;
}

.form-row {
	display: flex;
	flex-wrap: wrap;
	gap: 15px;
	margin-bottom: 15px;
}

.form-group {
	flex: 1 1 45%;
	display: flex;
	flex-direction: column;
	position: relative;
	z-index: auto;
}

.form-group.full-width {
	flex: 1 1 100%;
}

label {
	margin-bottom: 5px;
	font-weight: bold;
	color: #333;
}

input[type="text"], input[type="number"], select {
	padding: 8px;
	border: 1px solid #ddd;
	border-radius: 4px;
	box-sizing: border-box;
}

.search-button, .clear-button {
	color: white;
	padding: 12px 24px;
	border: none;
	border-radius: 4px;
	cursor: pointer;
	font-size: 1rem;
	margin: 10px 5px;
	text-decoration: none;
	display: inline-block;
	font-weight: bold;
}

.search-button {
	background-color: #8bb611;
}

.clear-button {
	background-color: #8bb611;
}

.search-button:hover, .clear-button:hover {
	opacity: 0.9;
}

.button-group {
	text-align: center;
	margin: 20px 0;
}

.links {
	margin-top: 15px;
	display: flex;
	justify-content: center;
	gap: 20px;
}

.links a {
	color: #8bb611;
	text-decoration: none;
	font-weight: bold;
}

.links a:hover {
	text-decoration: underline;
}

/* Bright blue footer */
footer {
	background-color: #8bb611;
	color: white;
	padding: 15px;
	border-radius: 0 0 8px 8px;
	text-align: center;
	margin-top: 20px;
}

footer i {
	color: white;
}

/* Results table styling */
table {
	width: 100%;
	border-collapse: collapse;
	margin-top: 20px;
}

th, td {
	padding: 12px;
	text-align: left;
	border-bottom: 1px solid #ddd;
	vertical-align: top;
}

th {
	background-color: #f8f9fa;
	font-weight: bold;
	color: #333;
}

tr:hover {
	background-color: #f5f5f5;
}

.status-available {
	color: #28a745;
	font-weight: bold;
}

.status-occupied {
	color: #dc3545;
	font-weight: bold;
}

.price-cell {
	color: #007bff;
	font-weight: bold;
}

.address-cell {
	max-width: 200px;
	line-height: 1.4;
}

.address-line1 {
	font-weight: bold;
	color: #333;
}

.address-line2 {
	color: #666;
	font-style: italic;
}

.county-badge {
	display: inline-block;
	background-color: #007bff;
	color: white;
	padding: 2px 8px;
	border-radius: 12px;
	font-size: 0.85em;
	margin-top: 4px;
}

.space-id {
	font-family: monospace;
	color: #666;
	font-size: 0.9em;
}

.empty-message {
	text-align: center;
	color: #666;
	font-style: italic;
	padding: 40px;
}

.results-summary {
	display: flex;
	justify-content: space-between;
	align-items: center;
	margin: 20px 0;
	padding: 15px;
	background-color: #f8f9fa;
	border-radius: 6px;
	border-left: 4px solid #8bb611;
}

.summary-item {
	text-align: center;
}

.summary-number {
	font-size: 1.5em;
	font-weight: bold;
	color: #007bff;
}

.summary-label {
	color: #666;
	font-size: 0.9em;
}

.messages {
	margin: 15px 0;
	padding: 10px;
	border-radius: 4px;
}

.messages .ui-messages-info {
	background-color: #d1ecf1;
	color: #0c5460;
	border: 1px solid #bee5eb;
}

.messages .ui-messages-error {
	background-color: #f8d7da;
	color: #721c24;
	border: 1px solid #f5c6cb;
}

/* Feature badge styling */
.feature-badge {
	display: inline-block;
	padding: 4px 8px;
	border-radius: 12px;
	font-size: 0.8em;
	font-weight: bold;
	margin: 2px;
	text-align: center;
}

.feature-accessible {
	background-color: #6f42c1;
	color: white;
}

.feature-bus {
	background-color: #fd7e14;
	color: white;
}

.feature-none {
	color: #999;
	font-style: italic;
}

.features-cell {
	min-width: 120px;
}

/* Responsive design */
@media ( max-width : 768px) {
	.form-group {
		flex: 1 1 100%;
	}
	.results-summary {
		flex-direction: column;
		gap: 10px;
	}
	table {
		font-size: 0.9em;
	}
	th, td {
		padding: 8px 4px;
	}
}

footer {
	position: relative;
}
</style>
</h:head>

<!-- Metadata must be placed between head and body -->
<f:metadata>
	<!-- populate the bean from the query parameter "address" -->
	<f:viewParam name="address" value="#{searchParkingBean.addressSearch}" />
	<!-- if address was provided, auto-run the search on page load -->
	<f:viewAction action="#{searchParkingBean.searchParkingSpaces}"
		if="#{not empty param.address}" />
</f:metadata>

<h:body>
	<div id="container">
		<header>
			<div class="header-title">
				<i class="fas fa-parking"></i> <span>ABC Parking Management</span>
			</div>
		</header>

		<main>
			<div class="search-box">
				<h2>Search Parking Spaces</h2>

				<!-- Display messages -->
				<h:messages globalOnly="true" styleClass="messages" />

				<h:form id="searchForm">

					<div class="search-section">
						<h3>Search Criteria</h3>

						<div class="form-row">
							<div class="form-group">
								<h:outputLabel for="max-price" value="Maximum Price (€)" />
								<h:inputText id="max-price"
									value="#{searchParkingBean.maxPrice}"
									placeholder="e.g. 5.00, 10.00..." />
							</div>
						</div>

						<div class="form-row">
							<div class="form-group">
								<h:outputLabel for="address-search" value="Address" />
								<h:inputText id="address-search"
									value="#{searchParkingBean.addressSearch}"
									placeholder="Search street address..." />
							</div>

							<div class="form-group">
								<h:outputLabel for="county-search" value="County" />
								<h:selectOneMenu id="county-search"
									value="#{searchParkingBean.countySearch}"
									styleClass="form-control">
									<f:selectItem itemValue="" itemLabel="-- All Counties --" />
									<f:selectItem itemValue="Dublin" itemLabel="Dublin" />
									<f:selectItem itemValue="Skerries" itemLabel="Skerries" />
									<f:selectItem itemValue="Malahide" itemLabel="Malahide" />
									<f:selectItem itemValue="Swords" itemLabel="Swords" />
								</h:selectOneMenu>
							</div>
						</div>

						<div class="form-row">
							<div class="form-group">
								<h:outputLabel for="accessible-filter" value="Filter Options" />
								<div style="display: flex; gap: 15px; margin-top: 8px;">
									<label
										style="display: flex; align-items: center; gap: 5px; font-weight: normal;">
										<h:selectBooleanCheckbox id="accessible-filter"
											value="#{searchParkingBean.accessibleOnly}" /> Accessible
										Only
									</label> <label
										style="display: flex; align-items: center; gap: 5px; font-weight: normal;">
										<h:selectBooleanCheckbox id="bus-filter"
											value="#{searchParkingBean.busOnly}" /> Near Bus Only
									</label>
								</div>
							</div>
						</div>
					</div>

					<div class="button-group">
						<h:commandButton value="Search Parking Spaces"
							action="#{searchParkingBean.searchParkingSpaces}"
							styleClass="search-button" />
						<h:commandButton value="Clear Search"
							action="#{searchParkingBean.clearSearch}" immediate="true"
							styleClass="clear-button" />
					</div>
				</h:form>

				<!-- Search Results Section -->
				<h:panelGroup rendered="#{searchParkingBean.searchPerformed}">
					<h:panelGroup
						rendered="#{not empty searchParkingBean.searchResults}">

						<div class="results-summary">
							<div class="summary-item">
								<div class="summary-number">#{searchParkingBean.searchResults.size()}</div>
								<div class="summary-label">Total Found</div>
							</div>
							<div class="summary-item">
								<div class="summary-number" style="color: #28a745;">#{searchParkingBean.availableResultsCount}</div>
								<div class="summary-label">Available</div>
							</div>
							<div class="summary-item">
								<div class="summary-number" style="color: #dc3545;">#{searchParkingBean.occupiedResultsCount}</div>
								<div class="summary-label">Occupied</div>
							</div>
						</div>

						<h2>Search Results</h2>
						<h:dataTable value="#{searchParkingBean.searchResults}"
							var="space" styleClass="table" headerClass="table-header"
							rowClasses="table-row">

							<h:column>
								<f:facet name="header">Space Number</f:facet>
								<h:outputText value="#{space.spaceNumber}" />
							</h:column>

							<!-- TODO: Member who has reserved will appear here otherwise blank -->
							<h:column>
								<f:facet name="header">Reserved</f:facet>
								<h:outputText />
							</h:column>

							<h:column>
								<f:facet name="header">Address</f:facet>
								<div class="address-cell">
									<div class="address-line1">
										<h:outputText value="#{space.address1}" />
									</div>
									<h:panelGroup rendered="#{not empty space.address2}">
										<div class="address-line2">
											<h:outputText value="#{space.address2}" />
										</div>
									</h:panelGroup>
									<div class="county-badge">
										<h:outputText value="#{space.county}" />
									</div>
								</div>
							</h:column>

							<h:column>
								<f:facet name="header">Price per Hour</f:facet>
								<h:outputText value="#{space.pricePerHour}"
									styleClass="price-cell">
									<f:convertNumber type="currency" currencySymbol="€"
										minFractionDigits="2" />
								</h:outputText>
							</h:column>

							<h:column>
								<f:facet name="header">Status</f:facet>
								<h:outputText
									value="#{space.available ? 'Available' : 'Occupied'}"
									styleClass="#{space.available ? 'status-available' : 'status-occupied'}" />
							</h:column>

							<h:column>
								<f:facet name="header">Accessible</f:facet>
								<div class="features-cell">
									<h:panelGroup rendered="#{space.accessibleParking}">
										<span class="feature-badge feature-accessible">
											Accessible </span>
									</h:panelGroup>
									<h:panelGroup rendered="#{not space.accessibleParking}">
										<span class="feature-none">No</span>
									</h:panelGroup>
								</div>
							</h:column>

							<h:column>
								<f:facet name="header">Near Bus</f:facet>
								<div class="features-cell">
									<h:panelGroup rendered="#{space.closeToBus}">
										<span class="feature-badge feature-bus"> Near Bus </span>
									</h:panelGroup>
									<h:panelGroup rendered="#{not space.closeToBus}">
										<span class="feature-none">No</span>
									</h:panelGroup>
								</div>
							</h:column>

							<h:column>
								<f:facet name="header">Actions</f:facet>
								<h:panelGroup rendered="#{space.available}">
									<h:link outcome="book-parking" value="Book"
										styleClass="search-button"
										style="padding: 6px 12px; margin: 0; font-size: 0.9em;">
										<f:param name="spaceId" value="#{space.id}" />
									</h:link>
								</h:panelGroup>
								<h:panelGroup rendered="#{not space.available}">
									<span style="color: #999; font-style: italic;">Occupied</span>
								</h:panelGroup>
							</h:column>

						</h:dataTable>
					</h:panelGroup>

					<h:panelGroup rendered="#{empty searchParkingBean.searchResults}">
						<div class="empty-message">
							<p style="color: white;">No parking spaces have been added yet.</p>
							<p style="color: white;">Try adjusting your search parameters or browse all parking
								spaces.</p>
						</div>
					</h:panelGroup>
				</h:panelGroup>

<!-- 				<div class="links">
					<h:link value="View All Parking Spaces" outcome="parking-list" />
				</div> -->
			</div>
		</main>


	</div>
</h:body>
</html>
